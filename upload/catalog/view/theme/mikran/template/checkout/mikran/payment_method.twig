<div id="payment_method_result">
    <div class="panel panel-info">
	<div class="panel-heading"> <h3 class="panel-title"><i class="fa fa-lg fa-credit-card" aria-hidden="true"></i> {{ text_payment_method }}</h3> </div>
	<div class="panel-body font-larger" id="payment-body">
	    {% include "mikran/template/checkout/mikran/_messages.twig" with {'module':'payment'} %}
	    <div class="relative-spinner hidden" id="payment-progress-spinner">
		<i class="fa fa-spinner fa-5x fa-spin" aria-hidden="true"></i>
	    </div>
	    {% if payment_methods %}
		{% for payment_method in payment_methods %}
		    <div class="radio">
			<label>{% if payment_method.code == code %}
			    <input type="radio" name="payment_method" value="{{ payment_method.code }}" checked="checked" />
			{% else %}
			    <input type="radio" name="payment_method" value="{{ payment_method.code }}" />
			{% endif %}
			{{ payment_method.title }}
			{% if payment_method.terms %}
			    ({{ payment_method.terms }})
			{% endif %}
			{% if payment_method.code == code %}
			    {{payment_method.html}}
			{% endif %}
			</label>
		    </div>
		{% endfor %}
	    {% endif %}
		
		{#
		<p><strong>{{ text_comments }}</strong></p>
		<p>
		<textarea name="comment" rows="8" class="form-control">{{ comment }}</textarea>
		</p>
		{% if text_agree %}
		<div class="buttons">
		<div class="pull-right">{{ text_agree }}
		{% if agree %}
		<input type="checkbox" name="agree" value="1" checked="checked" />
		{% else %}
		<input type="checkbox" name="agree" value="1" />
		{% endif %}
		&nbsp;
		<input type="button" value="{{ button_continue }}" id="button-payment-method" data-loading-text="{{ text_loading }}" class="btn btn-primary" />
		</div>
		</div>
		{% else %}
		<div class="buttons">
		<div class="pull-right">
		<input type="button" value="{{ button_continue }}" id="button-payment-method" data-loading-text="{{ text_loading }}" class="btn btn-primary" />
		</div>
		</div>
		{% endif %}
		#}
	</div>
    </div>
</div>

<script type="text/javascript">
 $(document).ready(function(){
     $("input[name='payment_method']").click(function(){
	 $.ajax({
	     url: 'index.php?route=checkout/mikran/payment_method',
	     dataType: 'html',
	     method: 'post',
	     data: $("input[name='payment_method']:checked"),
	     beforeSend: function(xhr) {
		 $("#payment-progress-spinner").removeClass("hidden");
		 $("#payment-body").css("opacity","0.3");
	     },
	     success: function(html) {
		 $("#payment_method_result").html(html);
		 // Create the event
		 $(document).trigger("update-totals-table");
	     },
	     error: function(xhr, ajaxOptions, thrownError) {
                 alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
	     }
         });
     });
 });
</script>
